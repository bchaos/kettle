!function(){var coffeeScript,compile,extend,fs,fse,path,readOptions,uglifyjs;path=require("path"),fs=require("fs"),fse=require("fs-extra"),extend=require("util")._extend,coffeeScript=require("coffee-script"),uglifyjs=require("uglify-js"),readOptions=function(content){var firstLine,i,item,j,key,len,match,options,ref,value;if(firstLine=content.slice(0,content.indexOf("\n")),match=/^\s*\#\s*(.+)/.exec(firstLine),options={},null==match)return options;for(ref=match[1].split(","),j=0,len=ref.length;len>j&&(item=ref[j],i=item.indexOf(":"),!(0>i));j++)key=item.slice(0,i).trim(),value=item.slice(i+1).trim(),value.match(/^(true|false|undefined|null|[0-9]+)$/)&&(value=eval(value)),options[key]=value;return options},compile=function(e,t){return fs.readFile(e,function(i,o){var n,r,a,l,s,u,c,p;if(null!=i)return i;if(a=o.toString(),p=extend(extend({},t),readOptions(a)),r=path.dirname(e),"none"!==p.out&&p.out!==!1){p.out?(u=p.out,path.extname(""===u)&&(u+=".js",delete p.out)):(u=path.basename(e),n=u.length-path.extname(u).length,u=u.slice(0,n)+".js"),s=path.resolve(r,u),p.sourceMap&&(p.sourceMap={},null==p.sourceMapRoot&&(p.sourceMapRoot=path.basename(s)),p.sourceMapSources=[e],null!=p.sourceMapFilename?p.sourceMapFilename=path.resolve(r,p.sourceMapFilename):(p.sourceMapFilename=s+".map",null==p.sourceMapURL&&(p.sourceMapURL=path.relative(s+path.sep+"..",p.sourceMapFilename))));try{l=coffeeScript.compile(a),fse.outputFile(s,l,function(e){return null!=e?console.log(e.message):void 0})}catch(f){return i=f,console.log(i.message),void 0}if(p.sourceMapFilename)try{return c=coffeeScript.compile(a,{sourceMap:!0,filename:p.sourceMapFilename}),fse.outputFile(p.sourceMapFilename,c.v3SourceMap,function(e){return null!=e?e:void 0})}catch(f){i=f,console.log(i.message)}}})},exports.init=function(e){return e.hasDomain("CoffeeCompiler")?void 0:(e.registerDomain("CoffeeCompiler",{major:1,minor:0}),e.registerCommand("CoffeeCompiler","compile",compile,!0,"Compiles a coffee-script file",["coffeePath"],null))}}.call(this);