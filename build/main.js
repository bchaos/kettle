!function(){define(function(e,t,n){var r,o,i,l,a,u,s,c,f,p,m,d,g,h,v;return f=brackets.getModule("project/ProjectManager"),a=brackets.getModule("utils/ExtensionUtils"),c=brackets.getModule("utils/NodeConnection"),r=brackets.getModule("utils/AppInit"),u=brackets.getModule("filesystem/FileSystem"),s=brackets.getModule("file/FileUtils"),o=brackets.getModule("language/CodeInspection"),i=brackets.getModule("document/DocumentManager"),l=brackets.getModule("editor/EditorManager"),d=function(e){var t;return t=new c,t.connect(!0).pipe(function(){var r;return r=a.getModulePath(n,"node/"+e),t.loadDomains([r],!0)}).pipe(function(){return t.domains[e]})},v=function(e){var t,n;return n=f.getProjectRoot().fullPath,t=u.getFileForPath(n+".brackets.json"),s.readAsText(t).then(e,function(){return t=u.getFileForPath(n+"compile.json"),s.readAsText(t).then(e,function(){return e()})})},h=function(e){var t,n;return n=f.getProjectRoot().fullPath,t=$.Deferred(),v(function(r){var o,i,l,a,u,s,c,f;o={kettle:[e]},null==r&&t.resolve(o);try{c=JSON.parse(r)}catch(p){i=p}if(null==i&&c.kettle instanceof Array)for(f=c.kettle,a=u=0,s=f.length;s>u;a=++u)l=f[a],c.kettle[a]=n+l;return c=$.extend({},o,c),t.resolve(c)}),t},p=function(e,t){var n,r,o,i,l;for(l=[],i=t.kettle,r=0,o=i.length;o>r;r++)n=i[r],l.push(e.compile(n,t));return $.when.apply($,l)},g=function(e){if("string"==typeof e)return{pos:{},message:e};switch(e.code){case"EACCES":case"ENOENT":return{pos:{},message:"Cannot open file '"+e.path+"'"};default:return e.filename!==l.getCurrentFullEditor().document.file.name&&{pos:{},message:"Error in file '"+e.filename+"' on line "+e.line+": "+e.message,type:e.type},{pos:{line:e.line-1,ch:e.index},message:e.message,type:e.type}}},m=function(e,t){var n,r,o;return r=new $.Deferred,n=d("CoffeeCompiler"),o=h(t),$.when(n,o).then(function(e,t){return p(e,t).then(function(){return r.resolve()},function(e){return r.resolve({errors:[g(e)]})})},function(e){return r.resolve({errors:[e]})}),r.promise()},i.on("documentSaved",function(e,t){var n,r,o,i,a,u;for(r=!1,u=["coffeescript","coffeescriptimproved"],o=0,i=u.length;i>o;o++)if(a=u[o],t.language.getId()===a){r=!0;break}if(l.getCurrentFullEditor().document===t&&r)try{return m(t.getText(),t.file.fullPath)}catch(s){return n=s,console.log(n.stack)}})})}.call(this);